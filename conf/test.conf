# ──────────────────────────────────────────────────────────────────┐
# SERVER 1: Main Website (Port 8080)								│
# ──────────────────────────────────────────────────────────────────┘
server {
	server_name localhost;
	listen 8080;
	host 0.0.0.0;
	root ./static;
	index index.html;
	client_max_body_size 10M;

	# Custom error pages
	error_page 404 /ErrorPages/404.html;
	error_page 403 /ErrorPages/403.html;
	error_page 500 /ErrorPages/500.html;


	# ✓ GET  http://localhost:8080/        → serves index.html
	# ✓ GET  http://localhost:8080/styles.css → serves CSS file
	# ✓ GET http://localhost:8080/ErrorPages/ → HTML directory listing
	# ✓ POST http://localhost:8080/        → uploads to ./static/
	# ✗ DELETE (405 Method Not Allowed)
	location / {
		allowed_methods GET POST;
		autoindex on;
		index index.html;
	}


	# ✓ GET http://localhost:8080/google → HTTP 301 + Location header
	location /google {
		allowed_methods GET;
		return 301 https://www.google.com;
	}

	# ✓ GET http://localhost:8080/custom → serves samplepage.html
	location /custom {
		allowed_methods GET;
		index samplepage.html;
	}
}


# ──────────────────────────────────────────────────────────────────┐
# SERVER 2: CGI Testing Server (Port 8081)							│
# ──────────────────────────────────────────────────────────────────┘
server {
	server_name cgi-test;
	listen 8081;
	host 0.0.0.0;
	root ./static;
	client_max_body_size 5M;

	error_page 404 /ErrorPages/404.html;
	error_page 500 /ErrorPages/500.html;

	location / {
		allowed_methods GET POST;
		index index.html;
	}


	# ✓ GET  http://localhost:8081/cgi-bin/test.php → executes PHP script
	location /cgi-bin {
		allowed_methods GET POST;
		cgi_extension .php /usr/bin/php-cgi;
	}


	# ✓ GET http://localhost:8081/python/test.py → executes Python script
	location /python {
		allowed_methods GET POST;
		cgi_extension .py /usr/bin/python3;
	}
}


# ──────────────────────────────────────────────────────────────────┐
# SERVER 3: File Upload Server (Port 8082)							│
# ──────────────────────────────────────────────────────────────────┘

server {
	server_name upload-server;
	listen 8082;
	host 0.0.0.0;
	root ./static;
	index index.html;
	client_max_body_size 20M;

	error_page 404 /ErrorPages/404.html;
	error_page 405 /ErrorPages/405.html;
	error_page 413 /ErrorPages/413.html;
	error_page 403 /ErrorPages/403.html;
	error_page 500 /ErrorPages/500.html;


	location / {
		allowed_methods GET;
		index index.html;
		autoindex on;
	}


	# ✓ POST http://localhost:8082/uploads → uploads files to ./static/uploads
	# ✓ DELETE http://localhost:8082/uploads/filename → deletes specified file
	location /uploads {
		allowed_methods POST DELETE GET OPTIONS;
		upload_path ./static/uploads;
		root ./static/uploads;
		autoindex on;
	}


	location /ErrorPages {
		allowed_methods GET;
		autoindex on;
	}
}


# ──────────────────────────────────────────────────────────────────┐
# SERVER 4: Error Testing Server (Port 8083)						│
# ──────────────────────────────────────────────────────────────────┘
server {
	server_name error-test;
	listen 8083;
	host 0.0.0.0;
	root ./static;
	client_max_body_size 1K;  # Very small limit to trigger 413

	error_page 400 /ErrorPages/400.html;
	error_page 403 /ErrorPages/403.html;
	error_page 404 /ErrorPages/404.html;
	error_page 405 /ErrorPages/405.html;
	error_page 413 /ErrorPages/413.html;
	error_page 500 /ErrorPages/500.html;


	location / {
		allowed_methods GET POST;
		index index.html;
	}


	# READONLY LOCATION TESTS
	# ✓ GET  http://localhost:8083/nonexistent → 404 Not Found
	# ✓ GET  http://localhost:8083/readonly/ErrorPages → 403 Forbidden
	# ✗ POST http://localhost:8083/readonly/ → 405 Method Not Allowed
	# ✗ DELETE → 405 Method Not Allowed
	location /readonly {
		allowed_methods GET;
		autoindex off;
	}
}


# ──────────────────────────────────────────────────────────────────┐
# CURL TEST															│
# ──────────────────────────────────────────────────────────────────┘

# 1. GET REQUESTS FOR STATIC FILES
#    curl http://localhost:8080/
#    curl http://localhost:8080/styles.css

# 2. DIRECTORY LISTING (autoindex)
#    curl http://localhost:8080/ErrorPages

# 3. HTTP REDIRECTIONS
#    curl -I http://localhost:8080/google

# 4. CGI EXECUTION
#	 curl -X POST -d "name=John&age=30" http://localhost:8081/cgi-bin/test.php
#    curl -X POST -d "name=John" http://localhost:8081/python/test.py

# 5. FILE UPLOAD
#    curl -X POST -F "file=@test.txt" http://localhost:8082/uploads

# 6. FILE DELETION
#    curl -X DELETE http://localhost:8082/files/test.txt

# 7. ERROR HANDLING
#    curl http://localhost:8080/nonexistent  # 404
#    curl -X DELETE http://localhost:8080/   # 405
#    curl -X POST --data-binary @largefile http://localhost:8083/tiny  # 413

# 8. STRESS TESTING
#    siege -c 50 -t 30s http://localhost:8080/