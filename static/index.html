<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Webserv 42</title>
	<link rel="stylesheet" href="/styles.css">
	<link rel="icon" type="image/x-icon" href="/favicon.png">
</head>
<body>

	<div style="text-align: center;">
		<i><small>Welcome to</small></i>
		<h1>WebServer 42</h1>
	</div>

	<div class="dashboard-grid">

		<div class="card">
			<h2>üìç Main Server (8080)</h2>
			<p>Basic browsing and errors.</p>
			
			<div class="btn-stack">
				<a href="/google" class="btn btn-primary">Google Redirect (301)</a>
				<a href="/ErrorPages/404.html" class="btn btn-danger">Test Error 404</a>
				<a href="/styles.css" class="btn btn-gray">Watch CSS</a>
			</div>
		</div>

		<div class="card">
			<h2>üêò CGI Server (8081)</h2>
			<p>Script execution.</p>
			
			<div class="btn-stack">
				<a href="http://localhost:8081/cgi-bin/test.php" target="_blank" class="btn btn-cgi">PHP Info</a>
				<a href="http://localhost:8081/python/test.py" target="_blank" class="btn btn-cgi">Python Script</a>
			</div>
		</div>

		<div class="card">
			<h2>üì§ Uploads (8082)</h2>
			<p>File uploading.</p>
			
			<form onsubmit="uploadRaw(); return false;">
				<input type="file" id="fileInput">
				<div class="btn-stack">
					<button type="submit" class="btn btn-success">Upload file</button>
					<a href="http://localhost:8082/uploads/" target="_blank" class="btn btn-gray">üìÇ Check files</a>
				</div>
			</form>
			<div id="status-upload" class="status"></div>
		</div>

		<div class="card">
			<h2>üóëÔ∏è Delete (8082)</h2>
			<p>File deleting.</p>
			
			<form onsubmit="deleteFile(); return false;">
				<input type="text" id="deleteInput" placeholder="Filename (e.g: ApproveMyProject.png)">
				<div class="btn-stack">
					<button type="submit" class="btn btn-danger">Delete file</button>
				</div>
			</form>
			<div id="status-delete" class="status"></div>
		</div>

	</div>

	<script>
		const UPLOAD_HOST = "http://localhost:8082";

		async function uploadRaw() {
			const input = document.getElementById('fileInput');
			const status = document.getElementById('status-upload');
			const file = input.files[0];

			if (!file) { status.innerHTML = '‚ö†Ô∏è Choose file'; return; }

			status.innerHTML = 'Sending...';

			try {
				const res = await fetch(`${UPLOAD_HOST}/uploads/${file.name}`, {
					method: 'POST',
					headers: { 'Content-Type': file.type || 'application/octet-stream' },
					body: file
				});
				
				if (res.ok || res.status === 201) {
					status.innerHTML = '<span class="ok">‚úÖ Uploaded successfully (201)</span>';
					input.value = '';
					autoClearStatus(status);
				} else {
					status.innerHTML = `<span class="fail">‚ùå Error ${res.status}</span>`;
				}
			} catch (e) {
				status.innerHTML = '<span class="fail">‚ùå Network error</span>';
			}
		}

		async function deleteFile() {
			const input = document.getElementById('deleteInput');
			const status = document.getElementById('status-delete');
			const name = input.value.trim();

			if (!name) { status.innerHTML = '‚ö†Ô∏è Type filename to delete'; return; }

			status.innerHTML = 'Deleting...';
			status.style.opacity = "1";

			try {
				const res = await fetch(`${UPLOAD_HOST}/uploads/${name}`, { method: 'DELETE' });

				if (res.ok || res.status === 204) {
					status.innerHTML = '<span class="ok">‚úÖ Deleted (204)</span>';
					input.value = '';
					autoClearStatus(status);
				} else {
					status.innerHTML = `<span class="fail">‚ùå Error ${res.status}</span>`;
				}
			} catch (e) {
				status.innerHTML = '<span class="fail">‚ùå Network Error</span>';
			}
		}
		function autoClearStatus(element) {
			setTimeout(() => {
				element.style.transition = "opacity 0.5s ease";
				element.style.opacity = "0";

				setTimeout(() => {
					element.innerHTML = "";
					element.style.opacity = "1";
					element.style.transition = "none";
				}, 500);
			}, 3000);
		}
	</script>
	<footer>
		<small><i><strong>By: antonimo, frmarian & jortiz-m</strong></i></small>
	</footer>
</body>
</html>